# SearchEngine
Документация SearchEngine

### [Оглавление](../index.md)

## Класс InvertedIndex
Класс реализует инвертированную индексацию документов.
### Выполняет следующие функции:
1. Очищает базу инвертированных индексов.
2. Запускает инвертированную индексацию документов в отдельных потоках.
3. Хранит базу инвертированных индексов.
4. Предоставляет ссылку на базу инвертированных индексов.
### Инвертированный индекс
Программа использует инвертированную индексацию для подсчёта встречаемости слов в документах. Инвертированный индекс - это список структур (в программе используется структура Entry), соответствующий каждому слову в базе документов. Сама структура представляет два поля: идентификатор документа и количество вхождений слова в этом документе. Набор слов и соответствующих списков таких структур представляет базу инвертированных индексов.\
Пример. Два документа состоят из слов: {milk milk milk lemon water water water}, {milk milk lemon milk milk water water lemon water water}.\
База будет представлять следующее:
| Слово | Entry  | Entry  |
|-------|--------|--------|
| lemon | {0, 1} | {1, 2} |
| milk  | {0, 3} | {1, 4} |
| water | {0, 3} | {1, 4} |

По этой базе осуществляется поиск по запросам.
### Конструкторы:
Инициализирует ссылку на базу документов.
```cpp
explicit InvertedIndex(const std::vector<std::string>& in_documents) : documents{in_documents} {}
```
Параметры: ссылка на базу документов.
\
Не является копируемым и перемещаемым (содержит мьютекс).
### Наиболее важные (интересные) закрытые функции-члены индексации документов:
#### Алгоритм подсчёта инвертированного индекса и наполнения базы:
- вызов функции "startInvertedIndexing". Разбивает прочитанные документы на группы. В каждой группе количество документов равно количеству всех документов делённое на количество потоков (рассчитанное заранее),
  и запускает в отдельных потоках функцию "defineWord".
  - вызов функции "defineWord". Определяет каждое следующее слово для поиска вхождений в документах и вызывает функцию "addWord".
    - вызов функции "addWord". Добавляет слово и структуру инвертированного индекса в базу инвертированных индексов.

Таким образом, после завершения работы всех потоков получается контейнер, содержащий базы инвертированного индекса для каждой группы документов.
- вызов функции "startInvertedIndexing"..., и после получения контейнера сформированного ранее вызывает функцию "mergeInvertedIndexBases".
  - вызов функции "mergeInvertedIndexBases". Сливает базы инвертированного индекса подготовленные в разных потоках в одну базу. Причём, эта функция рекурсивная. Объём контейнера как минимум не увеличивается, так как
  слитые базы перемещаются и размер усекается.

На выходе функции "startInvertedIndexing" формируется окончательная база инвертированного индекса.
##### Производительность:
Замеры времени рассчёта базы инвертированного индекса (обрабатывалось 843 документа, по 100'000 слов в каждом):
| Количество потоков | Время, сек |
|--------------------|------------|
| 1 поток            |   11,844   |
| 14 потоков         |    2,604   |

Как видно, при этом алгоритме разница по времени в 4,5 раза.\
Причём, использование мьютексов показало большее время чем при работе одного потока, так как каждому потоку приходилось ожидать доступ как на запись так и на чтение к общей базы инвертированного индекса.\
Стоит отметить, что всё вышесказанное справедливо только для указанного количества документов и размеру каждого документа. При других значениях время будет другое.
### Общедоступные функции-члены:
#### Обновить базу инвертированных индексов:
```cpp
void updateInvertedIndexes(const unsigned int desiredNumberOfThreads);
```
Параметры: желаемое количество потоков.
#### Получить ссылку на базу инвертированных индексов:
```cpp
const std::map<std::string, std::vector<Entry>>& getInvertedIndexes();
```
Возвращаемое значение: ссылка на базу инвертированных индексов
### Примеры
```cpp
#include "invertedIndex.h"

int main()
{
    //...
    //Получить ссылку на базу документов (in_documents)
    //

    //Создать объект класса InvertedIndex
    InvertedIndex invertedIndexObj(in_documents);
    //Обновить базу инвертированных индексов
    invertedIndexObj.updateInvertedIndexes();
    //Получить ссылку на базу инвертированных индексов
    const std::map<std::string, std::vector<Entry>>& invertedIndexes{invertedIndexObj.getInvertedIndexes()};
}
```
