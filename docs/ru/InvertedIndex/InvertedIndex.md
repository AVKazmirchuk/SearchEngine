# SearchEngine
Документация SearchEngine

### [Оглавление](../index.md)

## Класс InvertedIndex
Класс реализует инвертированную индексацию документов.
### Выполняет следующие функции:
1. Очищает базу инвертированных индексов.
2. Запускает инвертированную индексацию документов в отдельных потоках. Или обрабатывает прочитанные документы из файлов (базу документов), или обрабатывает каждый документ файла (базу путей документов). 
3. Хранит базу инвертированных индексов.
4. Предоставляет ссылку на базу инвертированных индексов.
### Инвертированный индекс
Программа использует инвертированную индексацию для подсчёта встречаемости слов в документах. Инвертированный индекс - это список структур (в программе используется структура Entry), соответствующий каждому слову в базе документов. Сама структура представляет два поля: идентификатор документа и количество вхождений слова в этом документе. Набор слов и соответствующих списков таких структур представляет базу инвертированных индексов.\
Пример. Два документа состоят из слов: {milk milk milk lemon water water water}, {milk milk lemon milk milk water water lemon water water}.\
База будет представлять следующее:
| Слово | Entry  | Entry  |
|-------|--------|--------|
| lemon | {0, 1} | {1, 2} |
| milk  | {0, 3} | {1, 4} |
| water | {0, 3} | {1, 4} |

По этой базе осуществляется поиск по запросам.
### Конструкторы:
Инициализирует ссылку на базу документов.
```cpp
InvertedIndex(const std::vector<std::string>& in_documents,
                           const std::size_t in_maximumAllowableErrorsNumber = 0,
                           const unsigned int in_desiredNumberOfThreads = std::thread::hardware_concurrency(),
                           const std::string& in_documentsBaseOrPathsBase = Constants::default_documentsBaseOrPathsBase())
    : documents{in_documents},
      maximumAllowableErrorsNumber{in_maximumAllowableErrorsNumber},
      desiredNumberOfThreads{in_desiredNumberOfThreads},
      documentsBaseOrPathsBase{in_documentsBaseOrPathsBase}
    {}
```
Параметры: ссылка на базу документов или путей файлов документов, максимальное количество непрочитанных файлов, желаемое количество потоков, признак формирования базы документов или путей файлов документов.
\
Не является копируемым (содержит фьючерс).
### Наиболее важные (интересные) закрытые функции-члены индексации документов:
#### Алгоритм подсчёта инвертированного индекса и наполнения базы:
- вызов функции "startInvertedIndexing". Разбивает прочитанные документы на группы. В каждой группе количество документов равно количеству всех документов делённое на количество потоков (рассчитанное заранее). 
  И запускает в отдельных потоках функцию "defineWord".
  - вызов функции "defineWord". Определяет каждое следующее слово для поиска вхождений в документах и вызывает функцию "addWord".
    - вызов функции "addWord". Добавляет слово и структуру инвертированного индекса в базу инвертированных индексов для каждого потока.

Таким образом, после завершения работы всех потоков получается контейнер, содержащий базы инвертированного индекса для каждой группы документов.
- вызов функции "startInvertedIndexing"..., и после получения контейнера сформированного ранее вызывает функцию "mergeInvertedIndexBases".
  - вызов функции "mergeInvertedIndexBases". Сливает базы инвертированного индекса подготовленные в разных потоках в одну базу. Причём, эта функция рекурсивная. Объём контейнера как минимум не увеличивается, так как
  слитые базы перемещаются и размер усекается.

На выходе функции "startInvertedIndexing" формируется окончательная база инвертированного индекса.
##### Производительность:
Замеры времени рассчёта базы инвертированного индекса подробно описаны в презентации.\
Причём, использование мьютексов показало большее время чем при работе одного потока, так как каждому потоку приходилось ожидать доступ как на запись так и на чтение к общей базе инвертированного индекса.\
Стоит отметить, что всё вышесказанное справедливо только для указанного количества документов и размера каждого документа. При других значениях разница в производительности будет другой.
### Общедоступные функции-члены:
#### Обновить базу инвертированных индексов:
```cpp
void updateInvertedIndexes();
```
#### Получить ссылку на базу инвертированных индексов:
```cpp
const std::map<std::string, std::vector<Entry>>& getInvertedIndexes();
```
Возвращаемое значение: ссылка на базу инвертированных индексов
### Примеры
```cpp
#include "invertedIndex.h"

int main()
{
    //...
    //Получить ссылку на базу документов или путей файлов документов (in_documents), максимальное количество непрочитанных файлов (maximumAllowableErrorsNumber), желаемое количество потоков (desiredNumberOfThreads), признак формирования базы документов или путей файлов документов (documentsBaseOrPathsBase).
    //

    //Создать объект класса InvertedIndex
    InvertedIndex invertedIndexObj(in_documents, maximumAllowableErrorsNumber, desiredNumberOfThreads, documentsBaseOrPathsBase);
    //Обновить базу инвертированных индексов
    invertedIndexObj.updateInvertedIndexes();
    //Получить ссылку на базу инвертированных индексов
    const std::map<std::string, std::vector<Entry>>& invertedIndexes{invertedIndexObj.getInvertedIndexes()};
}
```
